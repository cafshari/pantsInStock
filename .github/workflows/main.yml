name: check-pants-in-stock
on:
  workflow_dispatch:
  schedule:
  - cron: "0 12 * * *"
jobs:
  checkout-and-run-job:
    runs-on: ubuntu-latest
    steps:
      - name: Check out repository code
        uses: actions/checkout@v4
      
      - name: Setup Python
        uses: actions/setup-python@v5.0.0
        with:
          python-version: '3.x'
          cache: 'pip'
      
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
          playwright install
          
      - name: Invoke execution via pytest (parameters in pytest.ini file)
        id: pytest
        run: |
          pytest_output=$(pytest)
          echo "::set-output name=pytest_output::$pytest_output"
          echo "PYTEST_OUTPUT1=$pytest_output" >> "$GITHUB_OUTPUT"

      - name: Use Pytest output in the next step
        run: |
          echo "pytest_output value:  ${{ steps.pytest.outputs.pytest_output }}"
          echo "PYTEST_OUTPUT1 value:  ${{ steps.pytest.outputs.PYTEST_OUTPUT1 }}"
          
      - name: Send email
        if: ${{ steps.pytest.outputs.pytest_output }} == True
        uses: dawidd6/action-send-mail@v3.10.0
        with:
          # Connection URL protocol://user:password@server:port, protocol can be smtp or smtp+starttls, replaces server_address, server_port, secure, username and password
          connection_url: smtp://${{secrets.EMAIL_ADDRESS}}:${{secrets.GMAIL_APP_PASSWORD}}@smtp.gmail.com:25
          # Subject of mail message
          subject: result of pantsInStock
          # Recipients mail addresses (separated with comma)
          to: ${{secrets.DESTINATION_EMAIL_ADDRESS}}
          # Full name of mail sender (might be with an email address specified in <>)
          from: github-pantsInStock
          # Body of mail message (might be a filename prefixed with file:// to read from)
          body: your pants might be in stock, check https://bananarepublic.gap.com/browse/product.do?pid=2666360923230
          # HTML body of mail message (might be a filename prefixed with file:// to read from)
          # html_body: # optional
          # Carbon copy recipients (separated with comma)
          # cc: # optional
          # Blind carbon copy recipients (separated with comma)
          # bcc: # optional
          # An email address that will appear on the Reply-To field
          # reply_to: # optional
          # The Message-ID this message is replying to
          # in_reply_to: # optional
          # Allow unsigned/invalid certificates
          # ignore_cert: # optional
          # Convert body from Markdown to HTML (set content_type input as text/html too)
          # convert_markdown: # optional
          # Files that will be added to mail message attachments (separated with comma)
          # attachments: # optional
          # Set Priority level for the mail message to 'high', 'normal' (default) or 'low'
          # priority: # optional
          # Log option for nodemailer
          # nodemailerlog: # optional
          # Debug option for nodemailer
          # nodemailerdebug: # optional
                
